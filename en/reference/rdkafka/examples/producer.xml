 <section xml:id="rdkafka.examples-producer">
  <title>Producer</title>
  <para>
   This example shows how to use the <link linkend="class.rdkafka-kafkaproducer">producer</link>.
   <example>
    <title>Producer example</title>
    <programlisting role="php">
<![CDATA[
<?php

$rk = new RdKafka\Producer();
$rk->addBrokers("127.0.0.1");

$topic = $rk->newTopic("test");

for ($i = 0; $i < 10; $i++) {
    $topic->produce(RD_KAFKA_PARTITION_UA, 0, "Message $i");
    $rk->poll(0);
}

while ($rk->getOutQLen() > 0) {
    $rk->poll(50);
}

?>
]]>
    </programlisting>
   </example>
  </para>
     <para>
         For a proper shutdown of the <link linkend="class.rdkafka-kafkaproducer">producer</link> add this before exiting the producer.
         <example>
             <title>Shutdown example</title>
             <programlisting role="php">
                 <![CDATA[
<?php

//optionally purge messages not yet sent to the broker
$rk->purge(RD_KAFKA_PURGE_F_QUEUE);

//this is highly recommended, flush waits for all outstanding producer requests to be handled
//when not using flush, you might lose messages and message errors
$rk->flush(10000);

?>
]]>
             </programlisting>
         </example>
     </para>
 </section>
